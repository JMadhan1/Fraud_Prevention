{% extends "base.html" %}

{% block content %}
<!-- Enhanced Hero Section -->
<div class="row mb-5">
    <div class="col-12">
        <div class="hero-gradient text-white rounded-4 p-5 text-center position-relative">
            <!-- Animated Background Particles -->
            <div class="hero-particles">
                <div class="particle" style="width: 4px; height: 4px; top: 20%; left: 10%; animation-delay: 0s;"></div>
                <div class="particle" style="width: 2px; height: 2px; top: 60%; left: 80%; animation-delay: 1s;"></div>
                <div class="particle" style="width: 3px; height: 3px; top: 40%; left: 30%; animation-delay: 2s;"></div>
                <div class="particle" style="width: 5px; height: 5px; top: 80%; left: 60%; animation-delay: 3s;"></div>
                <div class="particle" style="width: 2px; height: 2px; top: 30%; left: 90%; animation-delay: 4s;"></div>
            </div>
            
            <div class="position-relative">
                <h1 class="display-3 fw-bold mb-4 fade-in-up">
                    <i data-feather="shield" class="me-3" style="width: 64px; height: 64px;"></i>
                    <br>
                    {% if current_user.is_authenticated %}
                        Welcome back, {{ current_user.first_name or 'Investor' }}!
                    {% else %}
                        InvestGuard AI
                    {% endif %}
                </h1>
                <p class="lead mb-5 fade-in-up" style="font-size: 1.3rem; max-width: 800px; margin: 0 auto;">
                    India's first comprehensive AI-powered investment fraud prevention platform with real-time social media monitoring, market manipulation detection, and SEBI compliance
                </p>
                
                <!-- Enhanced Statistics -->
                <div class="row g-4 justify-content-center mb-4">
                    <div class="col-md-3 fade-in-up">
                        <div class="glow-card rounded-4 p-4 stats-pulse">
                            <h2 class="mb-2 fw-bold display-6" data-stat="totalAlerts">{{ total_alerts }}</h2>
                            <div class="text-light opacity-75">Total Alerts Detected</div>
                            <i data-feather="alert-triangle" class="mt-2" style="width: 24px; height: 24px;"></i>
                        </div>
                    </div>
                    <div class="col-md-3 fade-in-up">
                        <div class="glow-card rounded-4 p-4 stats-pulse" style="animation-delay: 0.2s;">
                            <h2 class="mb-2 fw-bold display-6 text-danger" data-stat="highRiskAlerts">{{ high_risk_alerts }}</h2>
                            <div class="text-light opacity-75">High Risk Cases</div>
                            <i data-feather="alert-octagon" class="mt-2 text-danger" style="width: 24px; height: 24px;"></i>
                        </div>
                    </div>
                    <div class="col-md-3 fade-in-up">
                        <div class="glow-card rounded-4 p-4 stats-pulse" style="animation-delay: 0.4s;">
                            <h2 class="mb-2 fw-bold display-6 text-warning" data-stat="activeAlerts">{{ active_alerts }}</h2>
                            <div class="text-light opacity-75">Active Monitoring</div>
                            <i data-feather="eye" class="mt-2 text-warning" style="width: 24px; height: 24px;"></i>
                        </div>
                    </div>
                    <div class="col-md-3 fade-in-up">
                        <div class="glow-card rounded-4 p-4 stats-pulse" style="animation-delay: 0.6s;">
                            <h2 class="mb-2 fw-bold display-6 text-success" data-stat="platformsMonitored">15+</h2>
                            <div class="text-light opacity-75">Platforms Monitored</div>
                            <i data-feather="globe" class="mt-2 text-success" style="width: 24px; height: 24px;"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Call to Action -->
                <div class="fade-in-up" style="animation-delay: 0.6s;">
                    <a href="{{ url_for('analyzer') }}" class="btn btn-primary btn-lg me-3 px-5 py-3">
                        <i data-feather="search" class="me-2"></i>
                        Start Analysis
                    </a>
                    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary btn-lg px-5 py-3">
                        <i data-feather="activity" class="me-2"></i>
                        View Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-5">
    <div class="col-12">
        <h2 class="mb-4">
            <i data-feather="zap" class="me-2"></i>
            Quick Actions
        </h2>
    </div>
    
    <div class="col-md-4 mb-4 fade-in-up">
        <div class="card action-card h-100 border-0 shadow glow-card">
            <div class="card-body text-center p-4">
                <div class="mb-4">
                    <div class="icon-container d-flex justify-content-center align-items-center mx-auto" style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);">
                        <i data-feather="search" width="36" height="36" class="text-white"></i>
                    </div>
                </div>
                <h5 class="card-title fw-bold mb-3">Content Analyzer</h5>
                <p class="card-text text-muted">Analyze text, URLs, and media for fraud indicators using AI-powered detection algorithms.</p>
                <a href="{{ url_for('analyzer') }}" class="btn btn-primary">
                    <i data-feather="play" class="me-2"></i>
                    Start Analysis
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4 fade-in-up">
        <div class="card action-card h-100 border-0 shadow glow-card">
            <div class="card-body text-center p-4">
                <div class="mb-4">
                    <div class="icon-container d-flex justify-content-center align-items-center mx-auto" style="width: 80px; height: 80px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 20px; box-shadow: 0 8px 32px rgba(17, 153, 142, 0.3);">
                        <i data-feather="shield-check" width="36" height="36" class="text-white"></i>
                    </div>
                </div>
                <h5 class="card-title fw-bold mb-3">Advisor Verification</h5>
                <p class="card-text text-muted">Instantly verify investment advisor credentials against official SEBI database records.</p>
                <a href="{{ url_for('advisor') }}" class="btn btn-success">
                    <i data-feather="check-circle" class="me-2"></i>
                    Verify Now
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4 fade-in-up">
        <div class="card action-card h-100 border-0 shadow glow-card">
            <div class="card-body text-center p-4">
                <div class="mb-4">
                    <div class="icon-container d-flex justify-content-center align-items-center mx-auto" style="width: 80px; height: 80px; background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%, #fecfef 100%); border-radius: 20px; box-shadow: 0 8px 32px rgba(255, 154, 158, 0.3);">
                        <i data-feather="git-branch" width="36" height="36" class="text-white"></i>
                    </div>
                </div>
                <h5 class="card-title fw-bold mb-3">Network Analysis</h5>
                <p class="card-text text-muted">Visualize fraud networks and identify suspicious connection patterns across platforms.</p>
                <a href="{{ url_for('network') }}" class="btn btn-info">
                    <i data-feather="eye" class="me-2"></i>
                    View Network
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Real-time Monitoring Dashboard -->
<div class="row mb-5">
    <div class="col-12">
        <h2 class="mb-4">
            <i data-feather="activity" class="me-2"></i>
            Real-time Monitoring
        </h2>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i data-feather="wifi" class="me-2"></i>
                    Live Social Media Feed
                </h5>
            </div>
            <div class="card-body">
                <div id="social-media-feed" class="live-feed" style="height: 200px; overflow-y: auto;">
                    <div class="text-center text-muted py-4">
                        <i data-feather="radio" width="32" height="32" class="mb-2"></i>
                        <p>Monitoring 15+ platforms for suspicious activity...</p>
                        <div class="spinner-border spinner-border-sm" role="status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                    <i data-feather="trending-down" class="me-2"></i>
                    Market Anomaly Detector
                </h5>
            </div>
            <div class="card-body">
                <div id="market-anomalies" class="live-feed" style="height: 200px; overflow-y: auto;">
                    <div class="text-center text-muted py-4">
                        <i data-feather="bar-chart" width="32" height="32" class="mb-2"></i>
                        <p>Analyzing NSE/BSE for suspicious patterns...</p>
                        <div class="spinner-border spinner-border-sm" role="status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Fraud Alerts Ticker -->
<div class="row mb-5">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i data-feather="alert-triangle" class="me-2"></i>
                    Recent Fraud Alerts
                </h5>
            </div>
            <div class="card-body">
                {% if recent_alerts %}
                    <div class="alert-ticker">
                        {% for alert in recent_alerts %}
                            <div class="alert alert-{{ 'danger' if alert.severity == 'critical' else 'warning' if alert.severity == 'high' else 'info' }} mb-2">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <strong>Risk Score: {{ "%.1f"|format(alert.risk_score) }}/10</strong>
                                        <span class="badge bg-{{ 'danger' if alert.severity == 'critical' else 'warning' if alert.severity == 'high' else 'info' }} ms-2">
                                            {{ alert.severity.title() }}
                                        </span>
                                        <p class="mb-1 mt-2">{{ alert.content[:150] }}{% if alert.content|length > 150 %}...{% endif %}</p>
                                        <small class="text-muted">
                                            <i data-feather="clock" width="14" height="14" class="me-1"></i>
                                            {{ alert.created_at.strftime('%Y-%m-%d %H:%M') }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center text-muted py-4">
                        <i data-feather="check-circle" width="48" height="48" class="mb-3"></i>
                        <p>No recent fraud alerts. System is monitoring for threats.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Feature Highlights -->
<div class="row mb-5">
    <div class="col-12">
        <h2 class="mb-4">
            <i data-feather="star" class="me-2"></i>
            Advanced AI Features
        </h2>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <h5 class="card-title">
                    <i data-feather="cpu" class="me-2 text-primary"></i>
                    AI-Powered Detection
                </h5>
                <ul class="list-unstyled">
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>BERT-based Sentiment Analysis</li>
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>LSTM Rumor Classification</li>
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>Real-time Risk Scoring</li>
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>Multi-modal Analysis</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <h5 class="card-title">
                    <i data-feather="trending-up" class="me-2 text-warning"></i>
                    Market Manipulation Detection
                </h5>
                <ul class="list-unstyled">
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>Pump & Dump Detection</li>
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>Wash Trading Analysis</li>
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>Spoofing & Layering Alerts</li>
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>Cross-market Surveillance</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <h5 class="card-title">
                    <i data-feather="globe" class="me-2 text-info"></i>
                    Social Media Monitoring
                </h5>
                <ul class="list-unstyled">
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>Twitter/X Real-time Scanning</li>
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>WhatsApp & Telegram Monitoring</li>
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>Multi-language Processing</li>
                    <li><i data-feather="check" class="me-2 text-success" width="16" height="16"></i>Influencer Score Analysis</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Phase Implementation Status -->
<div class="row mb-5">
    <div class="col-12">
        <h2 class="mb-4">
            <i data-feather="layers" class="me-2"></i>
            Implementation Phases
        </h2>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card border-primary h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i data-feather="message-circle" class="me-2"></i>
                    Phase 1: Social Media Monitoring
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Progress</span>
                        <span class="text-primary">75%</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-primary" style="width: 75%"></div>
                    </div>
                </div>
                <ul class="list-unstyled mb-0">
                    <li><i data-feather="check-circle" class="me-2 text-success" width="16" height="16"></i>Social Media Scanner</li>
                    <li><i data-feather="check-circle" class="me-2 text-success" width="16" height="16"></i>Influence Score Analysis</li>
                    <li><i data-feather="clock" class="me-2 text-warning" width="16" height="16"></i>Rumor Detection Engine</li>
                    <li><i data-feather="clock" class="me-2 text-warning" width="16" height="16"></i>Multi-language Support</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card border-warning h-100">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i data-feather="trending-up" class="me-2"></i>
                    Phase 2: Market Manipulation
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Progress</span>
                        <span class="text-warning">45%</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-warning" style="width: 45%"></div>
                    </div>
                </div>
                <ul class="list-unstyled mb-0">
                    <li><i data-feather="check-circle" class="me-2 text-success" width="16" height="16"></i>Pattern Recognition Dashboard</li>
                    <li><i data-feather="clock" class="me-2 text-warning" width="16" height="16"></i>Algorithmic Behavior Analyzer</li>
                    <li><i data-feather="clock" class="me-2 text-warning" width="16" height="16"></i>Cross-market Surveillance</li>
                    <li><i data-feather="clock" class="me-2 text-warning" width="16" height="16"></i>Predictive Risk Scoring</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card border-info h-100">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i data-feather="book-open" class="me-2"></i>
                    Phase 3: Education Hub
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Progress</span>
                        <span class="text-info">30%</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-info" style="width: 30%"></div>
                    </div>
                </div>
                <ul class="list-unstyled mb-0">
                    <li><i data-feather="clock" class="me-2 text-warning" width="16" height="16"></i>Interactive Risk Simulator</li>
                    <li><i data-feather="clock" class="me-2 text-warning" width="16" height="16"></i>Vernacular Content Library</li>
                    <li><i data-feather="clock" class="me-2 text-warning" width="16" height="16"></i>Scam Alert Push Notifications</li>
                    <li><i data-feather="clock" class="me-2 text-warning" width="16" height="16"></i>AI Chatbot Advisor</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Call to Action -->
<div class="row">
    <div class="col-12">
        <div class="card bg-dark text-light border-0">
            <div class="card-body text-center py-5">
                <h3 class="mb-3">Ready to Protect Your Investments?</h3>
                <p class="lead mb-4">Join thousands of investors using FraudShield to stay safe from financial fraud.</p>
                <div class="d-flex gap-3 justify-content-center flex-wrap">
                    <a href="{{ url_for('dashboard') }}" class="btn btn-primary btn-lg">
                        <i data-feather="activity" class="me-2"></i>
                        View Dashboard
                    </a>
                    <a href="{{ url_for('reports') }}" class="btn btn-outline-light btn-lg">
                        <i data-feather="flag" class="me-2"></i>
                        Report Fraud
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Live updates for social media feed and market anomalies
    function updateSocialMediaFeed() {
        fetch('/api/social-media-feed')
            .then(response => response.json())
            .then(data => {
                const feedContainer = document.getElementById('social-media-feed');
                if (feedContainer && data.length > 0) {
                    feedContainer.innerHTML = data.map(item => `
                        <div class="feed-item mb-2 p-2 border-start border-3 border-${item.risk_level === 'Critical' ? 'danger' : item.risk_level === 'High' ? 'warning' : 'info'}">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong>${item.platform}</strong>
                                    <span class="badge bg-${item.risk_level === 'Critical' ? 'danger' : item.risk_level === 'High' ? 'warning' : 'info'} ms-2">${item.risk_level}</span>
                                    <p class="mb-1 mt-1">${item.content}</p>
                                    <small class="text-muted">${item.entities} entities detected • ${item.timestamp}</small>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            })
            .catch(error => console.log('Feed update failed:', error));
    }

    function updateMarketAnomalies() {
        fetch('/api/market-anomalies')
            .then(response => response.json())
            .then(data => {
                const anomaliesContainer = document.getElementById('market-anomalies');
                if (anomaliesContainer && data.length > 0) {
                    anomaliesContainer.innerHTML = data.map(item => `
                        <div class="anomaly-item mb-2 p-2 border-start border-3 border-danger">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong>${item.exchange} - ${item.stock}</strong>
                                    <span class="badge bg-danger ms-2">${item.type}</span>
                                    <p class="mb-1 mt-1">Risk Score: ${item.risk_score}/10</p>
                                    <small class="text-muted">Volume spike: ${item.volume_spike} • ${item.timestamp}</small>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            })
            .catch(error => console.log('Anomaly update failed:', error));
    }

    function updateStatistics() {
        fetch('/api/stats')
            .then(response => response.json())
            .then(data => {
                // Update statistics with animation
                const totalEl = document.querySelector('[data-stat="totalAlerts"]');
                const highRiskEl = document.querySelector('[data-stat="highRiskAlerts"]');
                const activeEl = document.querySelector('[data-stat="activeAlerts"]');
                
                if (totalEl) animateNumber(totalEl, data.total_alerts);
                if (highRiskEl) animateNumber(highRiskEl, data.high_risk_alerts);
                if (activeEl) animateNumber(activeEl, data.active_alerts);
            })
            .catch(error => console.log('Stats update failed:', error));
    }

    function animateNumber(element, newValue) {
        const currentValue = parseInt(element.textContent) || 0;
        const increment = (newValue - currentValue) / 20;
        let current = currentValue;
        
        const animation = setInterval(() => {
            current += increment;
            if ((increment > 0 && current >= newValue) || (increment < 0 && current <= newValue)) {
                current = newValue;
                clearInterval(animation);
            }
            element.textContent = Math.round(current);
        }, 50);
    }

    // Initialize live updates
    document.addEventListener('DOMContentLoaded', function() {
        // Initial load
        updateSocialMediaFeed();
        updateMarketAnomalies();
        
        // Set up intervals for real-time updates
        setInterval(updateSocialMediaFeed, 5000); // Update every 5 seconds
        setInterval(updateMarketAnomalies, 7000); // Update every 7 seconds
        setInterval(updateStatistics, 30000); // Update stats every 30 seconds
        
        // Welcome message fade-in animation
        const heroElements = document.querySelectorAll('.fade-in-up');
        heroElements.forEach((el, index) => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = 'all 0.6s ease';
            
            setTimeout(() => {
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
            }, index * 200);
        });
    });
</script>
{% endblock %}
